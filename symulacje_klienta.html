<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Symulacje Kredytowe dla Klienta</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Lora:wght@400;600&family=Source+Sans+Pro:wght@400;600;700&display=swap');

        body {
            font-family: 'Source Sans Pro', sans-serif;
            background-color: #333;
            color: #f0f0f0;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 20px auto;
            background-color: #424242;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.5);
        }
        h2 {
            text-align: center;
            color: #e0e0e0;
            margin-bottom: 30px;
            font-family: 'Lora', serif;
            font-weight: 600;
        }
        
        .controls-section {
            padding: 20px;
            background-color: #3a3a3a;
            border-radius: 10px;
            margin-bottom: 30px;
        }
        .input-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .input-group {
            position: relative;
        }
        .input-group label {
            display: block;
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 8px;
            color: #ccc;
        }
        input[type="number"] {
            width: 100%;
            padding: 10px;
            background-color: #525252;
            color: #f0f0f0;
            border: 1px solid #616161;
            border-radius: 8px;
            font-size: 16px;
            box-sizing: border-box;
        }
        .amount-input-container {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }
        .amount-input-container input {
            flex-grow: 1;
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 10px;
        }
        .checkbox-group label {
            background-color: #424242;
            border: 1px solid #616161;
            border-radius: 8px;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            transition: background-color 0.2s, border-color 0.2s;
            font-weight: 600;
        }
        .checkbox-group input { display: none; }
        .checkbox-group input:checked + label {
            background-color: #009688;
            color: #fff;
            border-color: #009688;
        }

        .action-button {
            background: none;
            border: 1px dashed #616161;
            color: #ccc;
            width: 100%;
            padding: 8px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
            margin-top: 5px;
        }
        .action-button:hover {
            background-color: #525252;
            color: #fff;
        }
        .remove-button {
            padding: 8px 12px;
            background-color: #757575;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        .generate-button {
            width: 100%;
            padding: 15px;
            font-size: 18px;
            font-weight: 600;
            color: #fff;
            background-color: #009688;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s;
            margin-top: 20px;
        }
        .generate-button:hover { background-color: #00796b; }

        .results-container {
            display: none;
            padding: 30px;
            background-color: #3a3a3a;
            border-radius: 10px;
        }
        
        .simulation-table-wrapper {
            overflow-x: auto;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 16px;
        }
        th, td {
            padding: 15px;
            text-align: right;
            border: none;
            border-bottom: 1px solid #525252;
        }
        th {
            font-family: 'Lora', serif;
            font-weight: 600;
            color: #e0e0e0;
            background-color: transparent;
            text-transform: uppercase;
            font-size: 13px;
            letter-spacing: 0.5px;
            color: #aaa;
        }
        th:first-child, td:first-child {
            text-align: left;
        }
        td.amount-header {
            font-weight: bold;
            font-size: 18px;
            color: #f0f0f0;
        }
        td.result-cell {
            font-weight: 600;
            font-size: 18px;
            color: #81c784;
            font-family: 'Source Code Pro', monospace;
        }
        tbody tr:hover {
            background-color: #424242;
        }
        
        .export-button {
            width: auto;
            padding: 12px 25px;
            font-size: 16px;
            font-weight: 600;
            color: #fff;
            background-color: #2196F3;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s;
            margin-top: 30px;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }
        .export-button:hover { background-color: #1976D2; }
    </style>
</head>
<body>

<div class="container">
    <h2>Generator Symulacji Kredytowych</h2>

    <div class="controls-section">
        <div class="input-grid">
            <div class="input-group">
                <label>Kwoty do symulacji (zł)</label>
                <div id="amountInputsContainer">
                    <div class="amount-input-container">
                        <input type="number" class="kwota-input" placeholder="np. 100000">
                    </div>
                </div>
                <button class="action-button" onclick="addAmountInput()">+ Dodaj kolejną kwotę</button>
            </div>
            <div class="input-group">
                 <label>Okresy kredytowania (w latach)</label>
                 <div class="checkbox-group" id="yearsCheckboxes"></div>
            </div>
            <div class="input-group">
                <label for="oprocentowanie">Oprocentowanie (%)</label>
                <input type="number" id="oprocentowanie" value="8.99" step="0.01">
            </div>
            <div class="input-group">
                <label for="prowizja">Prowizja (%)</label>
                <input type="number" id="prowizja" value="2.39" step="0.01">
            </div>
        </div>
        <button class="generate-button" onclick="generujSymulacje()">Generuj Tabelę Symulacji</button>
    </div>

    <div class="results-container" id="resultsContainer">
        <h3 style="font-family: 'Lora', serif; text-align: center; color: #e0e0e0; font-size: 22px; margin-bottom: 20px;">Symulacja Raty Miesięcznej</h3>
        <div class="simulation-table-wrapper">
            <table id="resultsTable">
                <thead></thead>
                <tbody></tbody>
            </table>
        </div>
        <button class="export-button" id="exportButton" onclick="generateWordDoc()">Eksportuj do Word (.doc)</button>
    </div>
</div>

<script>
    const formatCurrency = (value) => {
        if (!value || isNaN(value)) return "-";
        return value.toLocaleString('pl-PL', { style: 'currency', currency: 'PLN' });
    }
    
    function getPolishYearForm(number) {
        if (number === 1) return 'rok';
        const lastDigit = number % 10;
        const lastTwoDigits = number % 100;
        if (lastTwoDigits >= 12 && lastTwoDigits <= 14) return 'lat';
        if (lastDigit >= 2 && lastDigit <= 4) return 'lata';
        return 'lat';
    }

    function addAmountInput() {
        const container = document.getElementById('amountInputsContainer');
        const newDiv = document.createElement('div');
        newDiv.className = 'amount-input-container';
        newDiv.innerHTML = `
            <input type="number" class="kwota-input" placeholder="Kolejna kwota">
            <button class="remove-button" onclick="removeAmountInput(this)">Usuń</button>
        `;
        container.appendChild(newDiv);
    }
    
    function removeAmountInput(button) {
        button.parentElement.remove();
    }

    function initializeCheckboxes() {
        const container = document.getElementById('yearsCheckboxes');
        const years = [2, 3, 4, 5, 6, 7, 8, 9, 10];
        let html = '';
        years.forEach(year => {
            const yearText = getPolishYearForm(year);
            html += `
                <div>
                    <input type="checkbox" id="year_${year}" value="${year}" checked>
                    <label for="year_${year}">${year} ${yearText}</label>
                </div>
            `;
        });
        container.innerHTML = html;
    }

    function generujSymulacje() {
        const rocznaStopa = parseFloat(document.getElementById('oprocentowanie').value) || 0;
        const prowizjaProc = parseFloat(document.getElementById('prowizja').value) || 0;
        const resultsContainer = document.getElementById('resultsContainer');
        const tableHead = document.querySelector("#resultsTable thead");
        const tableBody = document.querySelector("#resultsTable tbody");
        
        tableHead.innerHTML = '';
        tableBody.innerHTML = ''; 

        const kwoty = [];
        document.querySelectorAll('.kwota-input').forEach(input => {
            const val = parseFloat(input.value);
            if (val > 0) {
                kwoty.push(val);
            }
        });

        const selectedYears = [];
        document.querySelectorAll('#yearsCheckboxes input[type="checkbox"]:checked').forEach(checkbox => {
            selectedYears.push(parseInt(checkbox.value));
        });

        if (kwoty.length === 0 || selectedYears.length === 0) {
            resultsContainer.style.display = 'none';
            alert("Proszę wpisać przynajmniej jedną kwotę i zaznaczyć przynajmniej jeden okres kredytowania.");
            return;
        }

        const r = (rocznaStopa / 100) / 12;

        let headerHTML = '<tr><th>Kwota Kredytu</th>';
        selectedYears.sort((a,b) => a-b).forEach(lata => {
            const yearText = getPolishYearForm(lata);
            headerHTML += `<th>${lata} ${yearText}</th>`;
        });
        headerHTML += '</tr>';
        tableHead.innerHTML = headerHTML;
        
        kwoty.forEach(kwota => {
            const newRow = tableBody.insertRow();
            let rowHTML = `<td class="amount-header">${formatCurrency(kwota)}</td>`;

            selectedYears.forEach(lata => {
                const n = lata * 12;
                const kwotaProwizji = kwota * (prowizjaProc / 100);
                const P_financed = kwota + kwotaProwizji;
                
                let miesiecznaRata = 0;
                if (P_financed > 0 && n > 0 && r > 0) {
                    const pmt = P_financed * (r * Math.pow(1 + r, n)) / (Math.pow(1 + r, n) - 1);
                    miesiecznaRata = Math.round(pmt * 100) / 100;
                }
                rowHTML += `<td class="result-cell">${formatCurrency(miesiecznaRata)}</td>`;
            });
            newRow.innerHTML = rowHTML;
        });
        
        resultsContainer.style.display = 'block';
    }
    
    function generateWordDoc() {
        if (document.querySelector("#resultsTable tbody").rows.length === 0) {
            alert("Brak danych do wygenerowania pliku. Najpierw wygeneruj symulację.");
            return;
        }

        // --- ZAKTUALIZOWANA FUNKCJA GENEROWANIA PLIKU .DOC Z CIEMNYM MOTYWEM ---
        
        const styles = `
            <style>
                /* Style dla głównego kontenera w Wordzie */
                .word-document {
                    background-color: #2b2b2b;
                    font-family: Calibri, Arial, sans-serif;
                    color: #e0e0e0;
                    padding: 50pt; /* Marginesy */
                }
                h1 {
                    font-size: 18pt;
                    color: #009688; /* Kolor akcentu - Teal */
                    text-align: center;
                    margin-bottom: 12pt;
                }
                p.subtitle {
                    font-size: 10pt;
                    color: #bbbbbb;
                    text-align: center;
                    margin-bottom: 24pt;
                }
                table {
                    width: 100%;
                    border-collapse: collapse;
                    font-size: 10pt;
                }
                th, td {
                    border: 1px solid #555555;
                    padding: 8px;
                    text-align: right;
                }
                th {
                    background-color: #3a3a3a;
                    color: #e0e0e0;
                    font-weight: bold;
                    text-align: center;
                }
                td.amount-header {
                    text-align: left;
                    font-weight: bold;
                    background-color: #424242;
                }
                td.result-cell {
                    color: #81c784; /* Zielony dla rat */
                    font-weight: bold;
                }
                .footer {
                    font-size: 8pt;
                    color: #888888;
                    text-align: center;
                    margin-top: 40pt;
                    border-top: 1px solid #555555;
                    padding-top: 10pt;
                }
            </style>
        `;

        const oprocentowanie = document.getElementById('oprocentowanie').value;
        const prowizja = document.getElementById('prowizja').value;
        const currentDate = new Date().toLocaleDateString('pl-PL');
        
        // Klonujemy tabelę, aby zachować jej klasy dla stylów CSS
        const tableForWord = document.getElementById("resultsTable").cloneNode(true);
        // Usuwamy style inline, aby arkusz stylów CSS miał pełną kontrolę
        tableForWord.querySelectorAll('[style]').forEach(el => el.removeAttribute('style'));

        let sourceHTML = `
            <!DOCTYPE html>
            <html lang="pl">
            <head>
                <meta charset='utf-8'>
                <title>Symulacja Kredytowa</title>
                ${styles}
            </head>
            <body>
                <div class="word-document">
                    <h1>Symulacja Raty Miesięcznej</h1>
                    <p class="subtitle">Przygotowano dla oprocentowania ${oprocentowanie}% i prowizji ${prowizja}%</p>
                    ${tableForWord.outerHTML}
                    <div class="footer">
                        <p>Wygenerowano: ${currentDate}</p>
                        <p><i>Dokument ma charakter wyłącznie informacyjny i nie stanowi oferty w rozumieniu Kodeksu Cywilnego.</i></p>
                    </div>
                </div>
            </body>
            </html>
        `;

        const source = 'data:application/vnd.ms-word;charset=utf-8,' + encodeURIComponent(sourceHTML);
        const fileDownload = document.createElement("a");
        document.body.appendChild(fileDownload);
        fileDownload.href = source;
        fileDownload.download = `symulacja_${currentDate.replace(/\./g, '-')}.doc`;
        fileDownload.click();
        document.body.removeChild(fileDownload);
    }

    document.addEventListener('DOMContentLoaded', initializeCheckboxes);
</script>
</body>
</html>
