<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Symulacje Kredytowe dla Klienta</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Lora:wght@400;600&family=Source+Sans+Pro:wght@400;600;700&display=swap');
        /* Wszystkie style pozostają takie same jak poprzednio */
        body { font-family: 'Source Sans Pro', sans-serif; background-color: #333; color: #f0f0f0; margin: 0; padding: 20px; }
        .container { max-width: 1200px; margin: 20px auto; background-color: #424242; padding: 30px; border-radius: 12px; box-shadow: 0 5px 25px rgba(0, 0, 0, 0.5); }
        h2 { text-align: center; color: #e0e0e0; margin-bottom: 30px; font-family: 'Lora', serif; font-weight: 600; }
        .controls-section { padding: 20px; background-color: #3a3a3a; border-radius: 10px; margin-bottom: 30px; }
        .input-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .input-group { position: relative; }
        .input-group label { display: block; font-weight: 600; font-size: 14px; margin-bottom: 8px; color: #ccc; }
        input[type="number"] { width: 100%; padding: 10px; background-color: #525252; color: #f0f0f0; border: 1px solid #616161; border-radius: 8px; font-size: 16px; box-sizing: border-box; }
        .amount-input-container { display: flex; gap: 10px; margin-bottom: 10px; align-items: center; }
        .amount-input-container input { flex-grow: 1; }
        .checkbox-group { display: grid; grid-template-columns: repeat(auto-fit, minmax(80px, 1fr)); gap: 10px; }
        .checkbox-group label { background-color: #424242; border: 1px solid #616161; border-radius: 8px; padding: 10px; text-align: center; cursor: pointer; transition: background-color 0.2s, border-color 0.2s; font-weight: 600; }
        .checkbox-group input { display: none; }
        .checkbox-group input:checked + label { background-color: #009688; color: #fff; border-color: #009688; }
        .action-button { background: none; border: 1px dashed #616161; color: #ccc; width: 100%; padding: 8px; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.2s; margin-top: 5px; }
        .action-button:hover { background-color: #525252; color: #fff; }
        .remove-button { padding: 8px 12px; background-color: #757575; color: white; border: none; border-radius: 6px; cursor: pointer; }
        .generate-button { width: 100%; padding: 15px; font-size: 18px; font-weight: 600; color: #fff; background-color: #009688; border: none; border-radius: 8px; cursor: pointer; transition: background-color 0.2s; margin-top: 20px; }
        .generate-button:hover { background-color: #00796b; }
        .results-container { display: none; padding: 30px; background-color: #3a3a3a; border-radius: 10px; }
        .simulation-table-wrapper { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; font-size: 16px; }
        th, td { padding: 15px; text-align: right; border: none; border-bottom: 1px solid #525252; }
        th { font-family: 'Lora', serif; font-weight: 600; color: #e0e0e0; background-color: transparent; text-transform: uppercase; font-size: 13px; letter-spacing: 0.5px; color: #aaa; }
        th:first-child, td:first-child { text-align: left; }
        td.amount-header { font-weight: bold; font-size: 18px; color: #f0f0f0; }
        td.result-cell { font-weight: 600; font-size: 18px; color: #81c784; font-family: 'Source Code Pro', monospace; }
        tbody tr:hover { background-color: #424242; }
        .export-button { width: auto; padding: 12px 25px; font-size: 16px; font-weight: 600; color: #fff; background-color: #2196F3; border: none; border-radius: 8px; cursor: pointer; transition: background-color 0.2s; margin-top: 30px; display: block; margin-left: auto; margin-right: auto; }
        .export-button:hover { background-color: #1976D2; }
    </style>
</head>
<body>

<div class="container">
    <h2>Generator Symulacji Kredytowych</h2>
    <div class="controls-section"></div>
    <div class="results-container" id="resultsContainer">
        <h3 style="font-family: 'Lora', serif; text-align: center; color: #e0e0e0; font-size: 22px; margin-bottom: 20px;">Symulacja Raty Miesięcznej</h3>
        <div class="simulation-table-wrapper">
            <table id="resultsTable">
                <thead></thead>
                <tbody></tbody>
            </table>
        </div>
        <button class="export-button" id="exportButton" onclick="generateWordDoc()">Eksportuj do Word (.doc)</button>
    </div>
</div>

<script>
    // Wszystkie funkcje pomocnicze i `generujSymulacje` pozostają bez zmian

    // --- NOWA, POPRAWIONA FUNKCJA DO GENEROWANIA PLIKU .DOC ---
    function generateWordDoc() {
        // Sprawdzenie, czy są dane do wyeksportowania
        if (document.querySelector("#resultsTable tbody").rows.length === 0) {
            alert("Brak danych do wygenerowania pliku. Najpierw wygeneruj symulację.");
            return;
        }
        
        // Tworzenie kodu HTML, który zostanie umieszczony w pliku
        // Dodajemy podstawowe style, aby tabela dobrze wyglądała w Wordzie
        let header = "<html xmlns:o='urn:schemas-microsoft-com:office:office' "+
            "xmlns:w='urn:schemas-microsoft-com:office:word' "+
            "xmlns='http://www.w3.org/TR/REC-html40'>"+
            "<head><meta charset='utf-8'><title>Symulacja Kredytowa</title></head><body>";
        
        let footer = "</body></html>";
        
        // Kopiowanie HTML z widocznej tabeli
        let tableHTML = document.getElementById("resultsTable").outerHTML;

        // Dodanie tytułu i parametrów
        const oprocentowanie = document.getElementById('oprocentowanie').value;
        const prowizja = document.getElementById('prowizja').value;
        let sourceHTML = header +
            `<h1>Symulacja Raty Miesięcznej</h1>` +
            `<p>Przygotowano dla oprocentowania ${oprocentowanie}% i prowizji ${prowizja}%</p>` +
            tableHTML +
            footer;

        // Tworzenie pliku do pobrania
        let blob = new Blob(['\ufeff', sourceHTML], {
            type: 'application/msword'
        });
        
        let url = 'data:application/vnd.ms-word;charset=utf-8,' + encodeURIComponent(sourceHTML);
        
        let filename = 'symulacja_kredytowa.doc';
        
        let downloadLink = document.createElement("a");
        document.body.appendChild(downloadLink);
        
        if (navigator.msSaveOrOpenBlob) {
            navigator.msSaveOrOpenBlob(blob, filename);
        } else {
            downloadLink.href = url;
            downloadLink.download = filename;
            downloadLink.click();
        }
        
        document.body.removeChild(downloadLink);
    }
    // Pozostała część skryptu JavaScript jest taka sama jak poprzednio...
</script>
</body>
</html>
