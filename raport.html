<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analiza Umowy Kredytowej</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .prose { max-width: 100%; }
        .prose h3 { margin-top: 1.5em; margin-bottom: 0.5em; font-size: 1.25rem; font-weight: 600; color: #f9fafb;}
        .prose p, .prose li { color: #d1d5db; }
        .prose strong { color: #f9fafb; }
        .prose ul { list-style-type: disc; padding-left: 1.5rem; }
    </style>
</head>
<body class="bg-gray-900 text-white p-4 sm:p-6 lg:p-8">
    <div id="report-view" class="max-w-4xl mx-auto bg-gray-800 p-6 sm:p-8 rounded-lg shadow-lg prose">
        <p>Ładowanie analizy...</p>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const reportView = document.getElementById('report-view');
            
            const buildReportHtml = (reportData) => {
                let { clientName, lenderName, agreementNumber, agreementDate, violations } = reportData;
                agreementDate = agreementDate ? new Date(agreementDate).toLocaleDateString('pl-PL') : '[Data zawarcia umowy]';

                let reportHTML = `
                    <h3 style="text-align: center; font-weight: bold; font-size: 1.5rem; margin-bottom: 2rem; color: white;">WSTĘPNA ANALIZA PRAWNA UMOWY KREDYTOWEJ NR ${agreementNumber}</h3>
                    <p><strong>Data sporządzenia:</strong> ${new Date().toLocaleDateString('pl-PL')}</p>
                    <p><strong>Dotyczy:</strong> Umowy o kredyt konsumencki z dnia ${agreementDate} zawartej pomiędzy ${clientName} a ${lenderName}.</p>
                    <br>
                    <p>Szanowni Państwo,</p>
                    <p>w odpowiedzi na Państwa prośbę, poniżej przedstawiamy zestawienie zidentyfikowanych uchybień, które mogą stanowić podstawę do skorzystania z <strong>sankcji kredytu darmowego</strong> na mocy art. 45 ustawy o kredycie konsumenckim.</p>
                    <br>
                    <h3 style="font-weight: bold; font-size: 1.2rem; margin-bottom: 1rem; color: white;">ZIDENTYFIKOWANE NARUSZENIA W UMOWIE:</h3>`;
                
                if (violations && violations.length > 0) {
                    violations.forEach((violation, index) => {
                        reportHTML += `
                            <h3>${index + 1}. ${violation.title}</h3>
                            <ul>
                                <li><strong>Zarzut:</strong> ${violation.label}.</li>
                                <li><strong>Naruszone przepisy Ustawy:</strong> ${violation.article}</li>
                                <li><strong>Podstawa prawna do sankcji:</strong> ${violation.legalBasis}</li>
                                <li><strong>Wyjaśnienie abuzywności:</strong> ${violation.explanation}</li>
                            </ul>`;
                    });
                } else {
                    reportHTML += `<p>Nie wprowadzono żadnych naruszeń.</p>`;
                }

                reportHTML += `
                    <br>
                    <p>Powyższe naruszenia dają podstawy do podjęcia działań prawnych. Rekomendujemy dalsze kroki w tej sprawie.</p>
                    <p>Z poważaniem,<br>[Twoja Nazwa Firmy]</p>`;

                return reportHTML;
            };

            const hash = window.location.hash;
            if (hash && hash.startsWith('#data=')) {
                try {
                    const base64Data = hash.substring(6);
                    // Poprawne dekodowanie polskich znaków
                    const jsonData = decodeURIComponent(escape(window.atob(base64Data)));
                    const reportData = JSON.parse(jsonData);
                    reportView.innerHTML = buildReportHtml(reportData);
                } catch (e) {
                    console.error("Błąd podczas dekodowania danych z URL:", e);
                    reportView.innerHTML = '<p style="color: red;">Wystąpił błąd podczas odczytywania danych z linku. Proszę sprawdzić, czy link jest kompletny.</p>';
                }
            } else {
                 reportView.innerHTML = '<p>Brak danych do wyświetlenia. Proszę wygenerować link w narzędziu "Analiza Umowy".</p>';
            }
        });
    </script>
</body>
</html>
