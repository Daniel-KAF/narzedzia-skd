<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulator WPS</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827;
            color: #d1d5db;
            padding: 20px;
        }
        .page-header {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
        }
        .logo {
            height: 80px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.4);
            border: 1px solid rgba(255,255,255,0.1);
        }
        h2 {
            text-align: left;
            margin: 0;
            font-weight: 900;
            font-size: 2.25rem;
            background-image: linear-gradient(to right, #60a5fa, #34d399);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background-color: #1f2937;
            padding: 30px;
            border-radius: 8px;
            border: 1px solid #374151;
        }
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
        }
        .input-section, .results-section {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .input-group {
            background-color: #374151;
            padding: 10px 15px;
            border-radius: 8px;
        }
        .input-group label {
            display: block;
            font-weight: 500;
            font-size: 14px;
            margin-bottom: 5px;
            color: #9ca3af;
        }
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 15px;
        }
        .checkbox-group label {
            margin-bottom: 0;
            color: #d1d5db;
        }
        input[type="checkbox"] {
            width: 1.2em;
            height: 1.2em;
            accent-color: #34d399;
        }
        input, select {
            width: 100%;
            padding: 10px;
            background-color: #4b5563;
            color: #f9fafb;
            border: 1px solid #6b7280;
            border-radius: 6px;
            font-size: 16px;
            box-sizing: border-box;
        }
        
        .results-section {
            gap: 12px;
        }
        .result-box {
            background-color: #374151;
            padding: 15px 20px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 4px solid #4b5563;
            gap: 20px;
        }
        .result-label {
            font-size: 14px;
            color: #9ca3af;
            text-transform: uppercase;
            font-weight: 500;
            margin: 0;
            line-height: 1.3;
        }
        .result-value {
            font-size: 26px;
            font-weight: 600;
            margin: 0;
            text-align: right;
            flex-shrink: 0;
        }

        .result-box.wps-highlight {
            border-left-color: #34d399;
        }
        .result-value.wps-value {
            color: #34d399;
            font-weight: 700;
            font-size: 28px;
        }
        .result-value.secondary-value {
            color: #9ca3af;
            font-weight: 500;
        }

        @media (max-width: 800px) {
            .main-grid { grid-template-columns: 1fr; }
            .result-box { 
                flex-direction: column; 
                align-items: flex-start; 
                gap: 5px; 
            }
            .result-value {
                text-align: left;
            }
        }
    </style>
</head>
<body>
    <header class="page-header">
        <img src="https://daniel-kaf.github.io/narzedzia-skd/logo.png" alt="Logo KAF" class="logo">
        <h2>Kalkulator WPS</h2>
    </header>
    <div class="container">
        <div class="main-grid">
            <div class="input-section">
                <div class="input-group">
                    <label for="kwotaKredytu">Kwota kredytu (tylko kapitał)</label>
                    <input type="number" id="kwotaKredytu" oninput="calculateWPS()">
                </div>
                <div class="input-group">
                    <label for="prowizja">Prowizja w umowie (kwotowo)</label>
                    <input type="number" id="prowizja" oninput="calculateWPS()">
                </div>
                <div class="input-group">
                    <label for="marza">Marża banku (%)</label>
                    <input type="number" id="marza" step="0.01" oninput="calculateWPS()">
                </div>
                <div class="input-group">
                    <label for="okresSplaty">Okres spłaty (msc)</label>
                    <input type="number" id="okresSplaty" oninput="calculateWPS()">
                </div>
                <div class="input-group">
                    <label for="dataPodpisania">Data podpisania umowy</label>
                    <input type="date" id="dataPodpisania" oninput="calculateWPS()">
                </div>
                
                <div class="checkbox-group">
                    <input type="checkbox" id="czySplacona">
                    <label for="czySplacona">Czy umowa została spłacona w całości?</label>
                </div>
                <div class="input-group" id="poleDataZakonczenia" style="display: none;">
                    <label for="dataZakonczenia">Data spłaty kredytu</label>
                    <input type="date" id="dataZakonczenia" oninput="calculateWPS()">
                </div>
                <div class="input-group" id="poleDataSymulacji">
                    <label for="dataSymulacji">Data dzisiejsza</label>
                    <input type="date" id="dataSymulacji" oninput="calculateWPS()">
                </div>
            </div>

            <div class="results-section">
                <div class="result-box wps-highlight">
                    <p class="result-label">WPS</p>
                    <p class="result-value wps-value" id="wynikWpsWTrakcie">0,00 zł</p>
                </div>
                <div class="result-box">
                    <p class="result-label">Odsetki pozostałe do spłaty (prognoza)</p>
                    <p class="result-value secondary-value" id="wynikUmorzoneOdsetki">0,00 zł</p>
                </div>
                 <div class="result-box">
                    <p class="result-label">Odsetki całkowite (wg umowy)</p>
                    <p class="result-value secondary-value" id="wynikOdsetkiCalkowite">0,00 zł</p>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const wibor3mHistory = {
        '2025-07-01': 5.80, '2025-04-01': 5.80, '2025-01-01': 5.82,
        '2024-10-01': 5.84, '2024-07-01': 5.86, '2024-04-01': 5.87, '2024-01-01': 5.88,
        '2023-10-01': 5.65, '2023-07-01': 6.90, '2023-04-01': 6.90, '2023-01-01': 6.99,
        '2022-10-01': 7.15, '2022-07-01': 7.00, '2022-04-01': 5.27, '2022-01-01': 2.55,
        '2021-10-01': 0.69, '2021-07-01': 0.22, '2021-04-01': 0.21, '2021-01-01': 0.21,
        '2020-10-01': 0.22, '2020-07-01': 0.23, '2020-04-01': 0.71, '2020-01-01': 1.71,
    };

    const formatCurrency = (value) => (value || 0).toLocaleString('pl-PL', { style: 'currency', currency: 'PLN' });
    const getValue = (id) => parseFloat(document.getElementById(id).value) || 0;

    function getWiborForDate(date) {
        let closestDate = null;
        for (const wiborDateStr in wibor3mHistory) {
            const wiborDate = new Date(wiborDateStr);
            if (wiborDate <= date && (!closestDate || wiborDate > closestDate)) {
                closestDate = wiborDate;
            }
        }
        return closestDate ? wibor3mHistory[closestDate.toISOString().split('T')[0]] : 0;
    }
    
    function calculateWPS() {
        const P_base = getValue('kwotaKredytu');
        const prowizja = getValue('prowizja');
        const marza = getValue('marza');
        const n_total = getValue('okresSplaty');
        const P_financed = P_base + prowizja;

        const dataPodpisaniaStr = document.getElementById('dataPodpisania').value;
        const isPaidOff = document.getElementById('czySplacona').checked;
        const dataZakonczeniaStr = document.getElementById('dataZakonczenia').value;
        const dataSymulacjiStr = document.getElementById('dataSymulacji').value;

        let effectiveEndDateStr = isPaidOff ? dataZakonczeniaStr : dataSymulacjiStr;

        if (!dataPodpisaniaStr || !effectiveEndDateStr) {
            document.getElementById('wynikWpsWTrakcie').textContent = formatCurrency(0);
            document.getElementById('wynikUmorzoneOdsetki').textContent = formatCurrency(0);
            document.getElementById('wynikOdsetkiCalkowite').textContent = formatCurrency(0);
            return;
        }

        const dataPodpisania = new Date(dataPodpisaniaStr);
        const effectiveEndDate = new Date(effectiveEndDateStr);
        
        let pozostalyKapital = P_financed;
        let sumaRzeczywistychOdsetek = 0;
        let currentDate = new Date(dataPodpisania);
        let miesiaceSplacone = 0;

        if (P_financed > 0) {
            while(currentDate < effectiveEndDate && miesiaceSplacone < n_total) {
                const wibor = getWiborForDate(currentDate);
                const rocznaStopa = marza + wibor;
                const r_miesieczna = (rocznaStopa / 100) / 12;
                const odsetkiWMiesiacu = pozostalyKapital * r_miesieczna;
                sumaRzeczywistychOdsetek += odsetkiWMiesiacu;

                const n_pozostalo_w_petli = n_total - miesiaceSplacone;
                let rataMiesieczna = 0;
                if (pozostalyKapital > 0 && n_pozostalo_w_petli > 0 && r_miesieczna > 0) {
                    rataMiesieczna = pozostalyKapital * (r_miesieczna * Math.pow(1 + r_miesieczna, n_pozostalo_w_petli)) / (Math.pow(1 + r_miesieczna, n_pozostalo_w_petli) - 1);
                } else if (pozostalyKapital > 0 && n_pozostalo_w_petli > 0) {
                    rataMiesieczna = pozostalyKapital / n_pozostalo_w_petli;
                }
                const splataKapitalu = rataMiesieczna - odsetkiWMiesiacu;
                pozostalyKapital -= splataKapitalu;
                currentDate.setMonth(currentDate.getMonth() + 1);
                miesiaceSplacone++;
            }
        }

        let wpsWTrakcie = 0;
        let odsetkiPozostale = 0;
        
        if (isPaidOff) {
            const miesiaceOszczedzone = n_total - miesiaceSplacone;
            const zwrotProwizji = (prowizja / n_total) * miesiaceOszczedzone;
            const faktycznyKosztProwizji = prowizja - zwrotProwizji;
            wpsWTrakcie = faktycznyKosztProwizji + sumaRzeczywistychOdsetek;
            odsetkiPozostale = 0; // Kredyt spłacony, więc nie ma przyszłych odsetek
        } else {
            wpsWTrakcie = prowizja + sumaRzeczywistychOdsetek;
            const n_pozostalo = n_total - miesiaceSplacone;
            if (pozostalyKapital > 0 && n_pozostalo > 0) {
                const wiborPrzyszly = getWiborForDate(effectiveEndDate);
                const przyszlaRocznaStopa = marza + wiborPrzyszly;
                const r_przyszle_miesieczne = (przyszlaRocznaStopa / 100) / 12;
                if (r_przyszle_miesieczne > 0) {
                    const pmt_przyszle = pozostalyKapital * (r_przyszle_miesieczne * Math.pow(1 + r_przyszle_miesieczne, n_pozostalo)) / (Math.pow(1 + r_przyszle_miesieczne, n_pozostalo) - 1);
                    odsetkiPozostale = (pmt_przyszle * n_pozostalo) - pozostalyKapital;
                }
            }
        }
        
        const umowneOprocentowanie = marza + getWiborForDate(dataPodpisania);
        const r_umowne = (umowneOprocentowanie / 100) / 12;
        let odsetkiCalkowiteWgUmowy = 0;
        if (P_financed > 0 && n_total > 0 && r_umowne > 0) {
            const pmt_umowne = P_financed * (r_umowne * Math.pow(1 + r_umowne, n_total)) / (Math.pow(1 + r_umowne, n_total) - 1);
            odsetkiCalkowiteWgUmowy = (pmt_umowne * n_total) - P_financed;
        }
        
        document.getElementById('wynikWpsWTrakcie').textContent = formatCurrency(wpsWTrakcie);
        document.getElementById('wynikUmorzoneOdsetki').textContent = formatCurrency(odsetkiPozostale);
        document.getElementById('wynikOdsetkiCalkowite').textContent = formatCurrency(odsetkiCalkowiteWgUmowy);
    }

    document.getElementById('czySplacona').addEventListener('change', function() {
        const poleDataZakonczenia = document.getElementById('poleDataZakonczenia');
        const poleDataSymulacji = document.getElementById('poleDataSymulacji');
        if (this.checked) {
            poleDataZakonczenia.style.display = 'block';
            poleDataSymulacji.style.display = 'none';
        } else {
            poleDataZakonczenia.style.display = 'none';
            poleDataSymulacji.style.display = 'block';
        }
        calculateWPS();
    });

    document.addEventListener('DOMContentLoaded', () => {
        document.getElementById('dataSymulacji').value = new Date().toISOString().split('T')[0];
        calculateWPS(); 
    });
</script>
</body>
</html>
